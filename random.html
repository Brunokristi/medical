<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag and Drop</title>
    <style>
        #draggable-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            background: #f3f3f3;
            min-height: 100px;
            border: 2px dashed #ccc;
        }

        .token {
            padding: 10px;
            background: lightblue;
            border: 1px solid #007bff;
            cursor: grab;
        }

        .dragging {
            opacity: 0.5;
        }
    </style>
</head>

<body>

    <div id="draggable-container">
        <div class="token">Item 1</div>
        <div class="token">Item 2</div>
        <div class="token">Item 3</div>
    </div>

    <script>
        function applyDragAndDrop() {
            let items = document.querySelectorAll(".token");

            items.forEach((item) => {
                item.draggable = true;
                item.removeEventListener("dragstart", dragStart);
                item.removeEventListener("dragend", dragEnd);
                item.addEventListener("dragstart", dragStart);
                item.addEventListener("dragend", dragEnd);
            });
        }

        function dragStart(e) {
            e.target.classList.add("dragging");
        }

        function dragEnd(e) {
            e.target.classList.remove("dragging");
            updateRoute();
        }

        function updateRoute() {
            console.log("Route updated!"); // Placeholder function
        }

        document.getElementById("draggable-container").addEventListener("dragover", (e) => {
            e.preventDefault();
            const container = document.getElementById("draggable-container");
            const afterElement = getDragAfterElement(container, e.clientY);
            const draggedItem = document.querySelector(".dragging");
            if (draggedItem) {
                if (afterElement == null) {
                    container.appendChild(draggedItem);
                } else {
                    container.insertBefore(draggedItem, afterElement);
                }
            }
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll(".token:not(.dragging)")];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Ensure drag & drop is set up when the page loads
        document.addEventListener("DOMContentLoaded", applyDragAndDrop);
    </script>

</body>

</html>